# Clone the repo as "dawn"
git clone https://dawn.googlesource.com/dawn dawn && cd dawn

# Fetch dependencies (lose equivalent of gclient sync)
python tools/fetch_dawn_dependencies.py

mkdir -p out/Debug
cd out/Debug
cmake ../..
make # -j N for N-way parallel build

echo "======================================================================================"
echo "====================================================================================== ls -R '$PWD'"
echo "======================================================================================"

ls -R

echo "======================================================================================"
echo "======================================================================================"
echo "======================================================================================"


# Zip build output
zip -9 -d -r dawn-mac-$ARCH-$BUILD_DATE.zip include bin lib gen || echo "could not zip artifacts"

echo "======================================================================================"
echo "======================================================================================"
echo "======================================================================================"

cp dawn-mac-$ARCH-$BUILD_DATE.zip ../.. || echo "could not copy zip up two dirs"

echo "======================================================================================"
echo "====================================================================================== ls ../.."
echo "======================================================================================"

ls ../..
