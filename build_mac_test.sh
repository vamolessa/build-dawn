# Clone the repo as "dawn"
git clone https://dawn.googlesource.com/dawn dawn && cd dawn

# Fetch dependencies (lose equivalent of gclient sync)
python tools/fetch_dawn_dependencies.py

mkdir -p out/Debug
cd out/Debug
cmake ../..
make # -j N for N-way parallel build

echo "======================================================================================"
echo "====================================================================================== ls -R lib"
echo "======================================================================================"

ls -R lib

echo "======================================================================================"
echo "====================================================================================== ls -R bin"
echo "======================================================================================"

ls -R bin

echo "======================================================================================"
echo "====================================================================================== ls -R gen"
echo "======================================================================================"

ls -R gen

echo "======================================================================================"
echo "====================================================================================== gonna zip it up!"
echo "======================================================================================"

# Zip build output
zip -9 -d -r dawn-mac-$ARCH-$BUILD_DATE.zip include bin lib gen || echo "could not zip artifacts"

echo "======================================================================================"
echo "======================================================================================"
echo "======================================================================================"

cp dawn-mac-$ARCH-$BUILD_DATE.zip ../.. || echo "could not copy zip up two dirs"


echo "======================================================================================"
echo "====================================================================================== ls ../.."
echo "======================================================================================"

cd ../..
ls

echo "======================================================================================"
echo "====================================================================================== find -name tint_cmd_tint_cmd"
echo "======================================================================================"

find -name tint_cmd_tint_cmd
